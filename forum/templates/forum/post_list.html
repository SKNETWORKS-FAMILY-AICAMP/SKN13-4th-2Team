{% extends 'base.html' %}
{% load i18n %}
{% load widget_tweaks %}

{% block content %}
<div class="max-w-2xl mx-auto py-8 px-4">
  <h1 class="text-2xl font-bold text-teal-400 mb-2">{{ thread.title }}</h1>
  <p class="text-sm text-gray-400 mb-4">
    {% trans "Author" %}: {{ thread.author.username }} | 
    {% trans "Created" %}: {{ thread.created_at|date:"Y-m-d H:i" }}
  </p>
  
  <hr class="border-gray-600 mb-6"/>

  <div class="space-y-4 mb-6">
    {% for post in posts %}
      <div class="bg-[#232323] rounded-xl shadow p-4">
        <div class="flex justify-between items-center">
          <div class="font-semibold text-teal-200">{{ post.author.username }}</div>
          <div class="text-xs text-gray-400">{{ post.created_at|date:"Y-m-d H:i" }}</div>
        </div>
        <div class="mt-2 text-gray-100 whitespace-pre-line">{{ post.content }}</div>
        
        {% if user.is_authenticated %}
          {% if user.pk == post.author.pk or user.is_superuser %}
            <div class="mt-3 flex gap-2">
              <a href="{% url 'forum:post_edit' post.id %}" class="px-3 py-1 text-sm bg-teal-700 hover:bg-teal-600 text-white rounded transition">
                {% trans "Edit" %}
              </a>
              <button type="button" class="px-3 py-1 text-sm bg-red-600 hover:bg-red-700 text-white rounded transition"
                      data-bs-toggle="modal" data-bs-target="#deletePostModal-{{ post.id }}">
                {% trans "Delete" %}
              </button>
            </div>
          {% endif %}
        {% endif %}
      </div>

      <!-- Delete Confirmation Modal -->
      <div class="modal fade" id="deletePostModal-{{ post.id }}" tabindex="-1" aria-labelledby="deleteModalLabel-{{ post.id }}" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content bg-[#191919] text-gray-100">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteModalLabel-{{ post.id }}">삭제 확인</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
            </div>
            <div class="modal-body">
              {{ post.author.username }} 님의 게시글을 정말 삭제하시겠습니까?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
              <form method="post" action="{% url 'forum:post_delete' post.id %}" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">삭제</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <p class="text-gray-400">아직 이 스레드에 게시글이 없습니다.</p>
    {% endfor %}
  </div>

  {% if user.is_authenticated %}
    <div class="bg-[#232323] rounded-xl shadow p-6 mb-8">
      <h2 class="text-lg font-semibold text-teal-300 mb-4">댓글 작성</h2>
      <form action="{% url 'forum:create_post' thread.id %}" method="post" class="space-y-3">
        {% csrf_token %}
        <div>
          {{ form.non_field_errors }}
          {{ form.content|add_class:"w-full px-4 py-2 rounded-lg border border-[#444] bg-[#191919] text-gray-100 focus:outline-none focus:ring-2 focus:ring-teal-500" }}
          {{ form.content.errors }}
        </div>
        <button class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded transition" type="submit">
          댓글 작성
        </button>
      </form>
    </div>
  {% else %}
    <p class="alert alert-info bg-[#232323] text-teal-200 rounded p-4">
      {% trans "Please" %} <a href="{% url 'accounts:login' %}" class="underline text-teal-300">{% trans "log in" %}</a> {% trans "to add a post." %}
    </p>
  {% endif %}

  <a class="bg-gray-700 hover:bg-gray-800 text-white px-4 py-2 rounded transition mt-2 inline-block" 
     href="{% url 'forum:thread_list' thread.category.id %}">
    {% trans "Back to Thread List" %}
  </a>
</div>
{% endblock %}
